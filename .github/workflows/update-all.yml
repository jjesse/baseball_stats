name: Update All Stats (Complete Rebuild)

on:
  workflow_dispatch:      # Manual trigger only
    inputs:
      reason:
        description: 'Reason for complete rebuild'
        required: false
        default: 'Manual complete rebuild'

jobs:
  trigger-all-updates:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Trigger Batting Stats Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-batting.yml',
              ref: 'main'
            });
            console.log('Triggered batting stats update');

      - name: Wait between triggers
        run: sleep 45

      - name: Trigger Pitching Stats Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-pitching.yml',
              ref: 'main'
            });
            console.log('Triggered pitching stats update');

      - name: Wait between triggers
        run: sleep 45

      - name: Trigger Standings Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-standings.yml',
              ref: 'main'
            });
            console.log('Triggered standings update');

      - name: Wait between triggers
        run: sleep 45

      - name: Trigger MVP & Cy Young Predictions Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-mvp-cy-young.yml',
              ref: 'main'
            });
            console.log('Triggered MVP & Cy Young predictions update');

      - name: Wait for MVP/Cy Young to complete before triggering tracking
        run: sleep 120

      - name: Trigger Prediction Tracking Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-prediction-tracking.yml',
              ref: 'main'
            });
            console.log('Triggered prediction tracking update');

      - name: Summary
        run: |
          echo "üöÄ Complete rebuild initiated with proper sequencing!"
          echo "‚úÖ Triggered batting stats update"
          echo "‚úÖ Triggered pitching stats update" 
          echo "‚úÖ Triggered standings update"
          echo "‚úÖ Triggered MVP & Cy Young predictions update"
          echo "‚úÖ Triggered prediction tracking update (after 2-minute delay)"
          echo ""
          echo "üìù Reason: ${{ github.event.inputs.reason }}"
          echo ""
          echo "‚è≥ Workflows triggered with proper delays to prevent conflicts."
          echo "üí° Check the Actions tab to monitor progress of all five workflows."
          echo "üïê Total estimated time: 25-30 minutes with sequential execution."
          echo ""
          echo "üìã Execution Order:"
          echo "1. Batting Stats (immediate)"
          echo "2. Pitching Stats (45s delay)"
          echo "3. Standings (90s delay)"
          echo "4. MVP & Cy Young (135s delay)"
          echo "5. Prediction Tracking (255s delay - waits for MVP/Cy Young completion)"