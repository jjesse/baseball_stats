name: Update All Stats (Complete Rebuild)

on:
  workflow_dispatch:      # Manual trigger only
    inputs:
      reason:
        description: 'Reason for complete rebuild'
        required: false
        default: 'Manual complete rebuild'

jobs:
  trigger-all-updates:
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Trigger Batting Stats Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-batting.yml',
              ref: '${{ github.ref_name }}'
            });
            console.log('Triggered batting stats update on branch: ${{ github.ref_name }}');

      - name: Trigger Pitching Stats Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-pitching.yml',
              ref: '${{ github.ref_name }}'
            });
            console.log('Triggered pitching stats update on branch: ${{ github.ref_name }}');

      - name: Trigger Standings Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-standings.yml',
              ref: '${{ github.ref_name }}'
            });
            console.log('Triggered standings update on branch: ${{ github.ref_name }}');

      - name: Trigger MVP & Cy Young Predictions Update
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'update-mvp-cy-young.yml',
              ref: '${{ github.ref_name }}'
            });
            console.log('Triggered MVP & Cy Young predictions update on branch: ${{ github.ref_name }}');

      - name: Summary
        run: |
          echo "üöÄ Complete rebuild initiated on branch: ${{ github.ref_name }}!"
          if [ "${{ github.ref }}" = "refs/heads/preview" ]; then
            echo "üìç Preview mode: Files will be published to /preview subdirectory"
            echo "üîó Preview URL: https://jjesse.github.io/baseball_stats/preview/"
          else
            echo "üìç Production mode: Files will be published to main site"
            echo "üîó Production URL: https://jjesse.github.io/baseball_stats/"
          fi
          echo "‚úÖ Triggered batting stats update"
          echo "‚úÖ Triggered pitching stats update" 
          echo "‚úÖ Triggered standings update"
          echo "‚úÖ Triggered MVP & Cy Young predictions update"
          echo ""
          echo "üìù Reason: ${{ github.event.inputs.reason }}"
          echo ""
          echo "‚è≥ Check the Actions tab to monitor progress of all four workflows."
          echo "üí° Workflows will run in parallel and may take 15-20 minutes total."